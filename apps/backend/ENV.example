# Local development example (DO NOT use in production)

# Database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/memalerts?schema=public

# Server
PORT=3001
NODE_ENV=development

# Request body limits (uploads are multipart and are not affected by these)
# Production defaults are intentionally tight to avoid memory pressure.
# JSON_BODY_LIMIT=1mb
# URLENCODED_BODY_LIMIT=1mb

# URLs (CORS)
WEB_URL=http://localhost:5173
OVERLAY_URL=http://localhost:5173

# Auth
JWT_SECRET=change-me
JWT_EXPIRES_IN=7d

# Twitch OAuth
TWITCH_CLIENT_ID=your_client_id
TWITCH_CLIENT_SECRET=your_client_secret
TWITCH_CALLBACK_URL=http://localhost:3001/auth/twitch/callback

# YouTube (Google OAuth) — external account linking
YOUTUBE_CLIENT_ID=your_google_client_id
YOUTUBE_CLIENT_SECRET=your_google_client_secret
YOUTUBE_CALLBACK_URL=http://localhost:3001/auth/youtube/link/callback

# YouTube shared bot account (server-side) — sends messages to chat as MemAlerts bot.
# How it works:
# - Streamers link YouTube with read-only scope (youtube.readonly) to let us resolve their channelId and detect LIVE.
# - Sending messages is done with a separate bot Google account refresh token stored in ENV below.
#
# Obtain refresh token for the bot account once (offline access) and paste it here:
# YOUTUBE_BOT_REFRESH_TOKEN=...

# VK OAuth — external account linking
VK_CLIENT_ID=your_vk_client_id
VK_CLIENT_SECRET=your_vk_client_secret
VK_CALLBACK_URL=http://localhost:3001/auth/vk/link/callback

# Twitch EventSub
TWITCH_EVENTSUB_SECRET=your_eventsub_secret

# Uploads
MAX_FILE_SIZE=52428800
UPLOAD_DIR=./uploads

# Heavy-work concurrency guards (protect CPU/IO under bursty uploads)
# VIDEO_FFPROBE_CONCURRENCY=2
# FILE_HASH_CONCURRENCY=2

# Storage provider for deduped meme files (FileHash.filePath stores a public path/URL)
# - local: stores under /uploads/memes/{hash}.{ext} (served by nginx/express static)
# - s3: stores into S3-compatible storage and returns S3_PUBLIC_BASE_URL + key as filePath
# UPLOAD_STORAGE=local
#
# S3-compatible storage (required when UPLOAD_STORAGE=s3)
# S3_BUCKET=your_bucket
# S3_ACCESS_KEY_ID=your_access_key
# S3_SECRET_ACCESS_KEY=your_secret
# S3_PUBLIC_BASE_URL=https://cdn.example.com   # must point to the bucket origin or CDN in front
# Optional:
# S3_ENDPOINT=https://<account>.r2.cloudflarestorage.com  # R2/MinIO endpoint
# S3_REGION=auto
# S3_KEY_PREFIX=memalerts
# S3_FORCE_PATH_STYLE=1

# Optional: Redis (shared cache + Socket.IO scaling)
# REDIS_URL=redis://localhost:6379
#
# Optional: Redis-backed rate limiting (recommended when REDIS_URL is set / multi-instance)
# RATE_LIMIT_REDIS=1

# Optional: Twitch chat bot (collect chatters for credits overlay)
# CHAT_BOT_ENABLED=1
# CHAT_BOT_LOGIN=lotas_bot
# One of:
# CHAT_BOT_USER_ID=<internal user UUID in DB>
# CHAT_BOT_TWITCH_USER_ID=<twitch user id>
# Map Twitch channel login -> memalerts channel slug:
# - Simple (recommended): CHAT_BOT_CHANNELS=lotas:<slug>,another:<slug2>
# - JSON (optional): CHAT_BOT_CHANNEL_MAP_JSON=[{"login":"lotas","slug":"<your-channel-slug>"}]
#
# Optional: Global chat bot runner (DB subscriptions)
# Run separately via: pnpm build && pnpm start:chatbot
# CHATBOT_BACKEND_BASE_URL=http://127.0.0.1:3001
# CHATBOT_SYNC_SECONDS=30
#
# Optional: YouTube chat bot runner (DB subscriptions)
# Run separately via: pnpm build && pnpm start:youtube-chatbot
# NOTE:
# - Streamer linking uses read-only scope only (youtube.readonly).
# - Sending chat messages requires the server-side bot token (YOUTUBE_BOT_REFRESH_TOKEN) with youtube.force-ssl.
# Uses the same internal relay base URLs:
# CHATBOT_BACKEND_BASE_URL=http://127.0.0.1:3001
# YOUTUBE_CHATBOT_SYNC_SECONDS=20
# YOUTUBE_CHATBOT_LIVE_CHECK_SECONDS=20
# YOUTUBE_CHATBOT_COMMANDS_REFRESH_SECONDS=30
# YOUTUBE_CHATBOT_OUTBOX_POLL_MS=1000

# Optional: VKVideo chat bot runner (DB subscriptions)
# Run separately via: pnpm build && pnpm start:vkvideo-chatbot
# VKVIDEO_CHAT_BOT_ENABLED=1
# Uses the same internal relay base URLs:
# CHATBOT_BACKEND_BASE_URL=http://127.0.0.1:3001
# VKVIDEO_API_BASE_URL=https://live.vkvideo.ru (пример; см docs/VKVIDEO_LIVE_API.md)
# VKVIDEO_PUBSUB_WS_URL=wss://pubsub-dev.live.vkvideo.ru/connection/websocket?format=json&cf_protocol_version=v2
# VKVIDEO_CHATBOT_SYNC_SECONDS=30
# VKVIDEO_CHATBOT_OUTBOX_POLL_MS=1000
# VKVIDEO_CHATBOT_COMMANDS_REFRESH_SECONDS=30
# Pubsub connect/subscription token refresh interval (avoid reconnect churn):
# VKVIDEO_PUBSUB_REFRESH_SECONDS=600
# Optional: cache TTL for VKVideo role lookups (only used for role-gated commands):
# VKVIDEO_USER_ROLES_CACHE_TTL_MS=30000

# Rollups (performance)
# Daily rollup (per-channel): aggregates MemeActivation by day (used by /streamer/stats/channel daily chart)
# CHANNEL_DAILY_STATS_ROLLUP_DAYS=45
# CHANNEL_DAILY_STATS_ROLLUP_INTERVAL_MS=300000
# CHANNEL_DAILY_STATS_ROLLUP_INITIAL_DELAY_MS=60000
#
# Top stats rollup (30d window): replaces heavy groupBy for top users/memes and viewer monthly stats
# TOP_STATS_30D_ROLLUP_DAYS=30
# TOP_STATS_30D_ROLLUP_INTERVAL_MS=300000
# TOP_STATS_30D_ROLLUP_INITIAL_DELAY_MS=90000
#
# Meme daily rollup (viewer day/week stats, and can be used to assemble month/year if needed)
# MEME_DAILY_STATS_ROLLUP_DAYS=45
# MEME_DAILY_STATS_ROLLUP_INTERVAL_MS=300000
# MEME_DAILY_STATS_ROLLUP_INITIAL_DELAY_MS=75000

# Optional tuning
# LOG_LEVEL=debug
# HTTP_COMPRESSION=1
# SEARCH_PAGE_MAX=50
# SEARCH_CACHE_MS=30000
# MEME_STATS_CACHE_MS=30000
# PROMO_CACHE_MS=5000

